const loginBtn=document.getElementById("login"),logoutBtn=document.getElementById("logout"),form=document.getElementById("form"),channelNameInput=document.getElementById("channel-name-input"),table=document.getElementById("table"),channelNames=document.querySelector(".channel-names"),loginMsg=document.querySelector(".login-msg"),channelNameLoader=document.getElementById("channel-name-loader"),loadMoreChannelBtn=document.getElementById("load-more-c");let ytState={};const channelStats=document.querySelector(".channel-stats"),r1=document.getElementById("r1"),r2=document.getElementById("r2"),r3=document.getElementById("r3"),r4=document.getElementById("r4"),r5=document.getElementById("r5"),r6=document.getElementById("r6"),CLIENT_ID="836548214787-m9muhc68m9kr68usnncskdd0to7bov4i.apps.googleusercontent.com",DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],SCOPES="https://www.googleapis.com/auth/youtube.readonly";function handleClientLoad(){gapi.load("client:auth2",initClient)}function initClient(){gapi.client.init({discoveryDocs:DISCOVERY_DOCS,clientId:CLIENT_ID,scope:SCOPES}).then(()=>{gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus),updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get())})}function updateSigninStatus(e){loadMoreChannelBtn.style.display="none",channelStats.style.display="none",e?(loginBtn.style.display="none",logoutBtn.style.display="block",form.style.display="block",channelNames.style.display="block",loginMsg.style.display="none",channelNameLoader.style.display="none"):(loginBtn.style.display="block",logoutBtn.style.display="none",form.style.display="none",channelNames.style.display="none",loginMsg.style.display="inline-block",channelNameLoader.style.display="none")}function handleSigninClick(){gapi.auth2.getAuthInstance().signIn({scope:SCOPES}).then(function(){},function(e){alert("Error signing in. Please reload page and try again!")})}function handleSignoutClick(){gapi.auth2.getAuthInstance().signOut()}function addNewCard(e,t,n,a,l="four"){const i=document.createElement("div");i.classList=`columns card ${l}`;const s=document.createElement("p");let o;switch(s.innerHTML=e,s.style.textTransform="capitalize",n){case 1:(o=document.createElement("p")).innerHTML=void 0!==t?t:"N/A";break;case 2:(o=document.createElement("a")).href=t,o.target="_blank",el3=document.createElement("img"),el3.src=t,o.appendChild(el3);break;case 3:(o=document.createElement("a")).href=t,o.target="_blank",o.innerHTML=t;break;case 4:o=document.createElement("p");let a=t.substring(0,4),l=t.substring(5,7),i=t.substring(8,10);o.innerHTML=`${i}.${l}.${a} (DD.MM.YYYY)`;break;case 5:o=document.createElement("p"),t=(t=t.replace(/" /g,", ")).replace(/"/g,""),o.innerHTML=t;break;case 6:(o=document.createElement("p")).innerHTML="",t.forEach(e=>{o.innerHTML+=`<a href="${e}" target="_blank" style="text-transform: lowercase;">${e}</a>`})}"A"!=o.tagName&&(o.style.textTransform="capitalize"),i.appendChild(s),i.appendChild(o),a.appendChild(i)}function setRowStyle(e){const t=[r1,r2,r3,r4,r5,r6];0==e?t.forEach(e=>e.innerHTML=""):t.forEach(e=>{let t=e.querySelectorAll("div"),n=0;t.forEach(e=>{n=e.clientHeight>n?e.clientHeight:n}),t.forEach(e=>e.style.minHeight=n+"px")})}async function showChannelStats(e){setRowStyle(0),channelStats.style.display="block",channelNames.style.display="none",loadMoreChannelBtn.style.display="none";const t={part:["snippet,statistics,topicDetails,status,brandingSettings"],id:[e.target.id],fields:"items(id,snippet(title,description,customUrl,publishedAt,thumbnails/high/url,country),statistics,topicDetails/topicCategories,status(privacyStatus,madeForKids),brandingSettings(channel/keywords,image))"};try{let e=await gapi.client.youtube.channels.list(t);addNewCard("Channel name",(e=e.result.items[0]).snippet.title,1,r1),e.snippet.customUrl?addNewCard("Channel link",`https://www.youtube.com/c/${e.snippet.customUrl}`,3,r1):addNewCard("Channel link",`youtube.com/channel/${e.id}`,3,r1),addNewCard("Published date",e.snippet.publishedAt,4,r1),addNewCard("Description",e.snippet.description,1,r2,""),addNewCard("Country",e.snippet.country,1,r3),addNewCard("Total videos",e.statistics.videoCount,1,r3),e.statistics.hiddenSubscriberCount?addNewCard("Total subscribers","Private",1,r3):addNewCard("Total Subscribers",e.statistics.subscriberCount,1,r3),addNewCard("Total views",e.statistics.viewCount,1,r4),addNewCard("Privacy status",e.status.privacyStatus,1,r4),addNewCard("Made for kids",e.status.madeForKids,1,r4),e.topicDetails?addNewCard("Channel category wikipedia links",e.topicDetails.topicCategories,6,r5,"six"):addNewCard("Channel category wikipedia links","N/A",1,r5,"six"),e.brandingSettings.channel.keywords?addNewCard("Keywords associated with channel",e.brandingSettings.channel.keywords,5,r5,"six"):addNewCard("Keywords associated with channel","N/A",1,r5,"six"),addNewCard("Channel icon",e.snippet.thumbnails.high.url,2,r6),e.brandingSettings.image?addNewCard("Banner image",e.brandingSettings.image.bannerExternalUrl,2,r6,"eight"):addNewCard("Banner Image","https://via.placeholder.com/2048x1152?text=No+Banner+Image+Found",2,r6,"eight"),setRowStyle(1)}catch(e){alert("Something went wront in fetching channel stats.")}}function addChannelNames(e){for(let t=0;t<e.length;t++){const n=document.createElement("li");n.classList.add("h-shadow"),n.classList.add("grow"),n.id=e[t].snippet.channelId,n.innerHTML=`<img src="${e[t].snippet.thumbnails.medium.url}"> ${e[t].snippet.title}`,setTimeout(()=>{channelNames.appendChild(n),n.addEventListener("click",showChannelStats)},150*t)}}async function getChannels(e=ytState.q,t=ytState.pageToken){channelNameLoader.style.display="block",ytState.q=e;const n={part:["snippet"],maxResults:5,q:e,type:["channel"],pageToken:t,fields:"nextPageToken,pageInfo/totalResults,items(snippet(channelId,title,description,thumbnails/medium))"};try{const e=await gapi.client.youtube.search.list(n);return ytState.pageToken=e.result.nextPageToken,ytState.totalResults=e.result.pageInfo.totalResults,e.result.items}catch(e){throw 403==e.result.error.code?alert("Today's API quota had been exceeded."):alert("Something went wront in fetching channels."),new Error("Some error orccured")}finally{channelNameLoader.style.display="none"}}async function searchChannel(e){e.preventDefault(),ytState={},channelStats.style.display="none",channelNames.style.display="block",channelNames.innerHTML="";const t=channelNameInput.value.trim();if(0==t.length)return alert("Please enter a valid search query"),void(channelNameLoader.style.display="none");try{addChannelNames(await getChannels(t)),loadMoreChannelBtn.style.display="block",channelNameInput.textContent=""}catch(e){}}async function loadMoreChannels(){if(void 0!==ytState.pageToken)try{addChannelNames(await getChannels())}catch{}else loadMoreChannelBtn.style.display="none"}loginBtn.addEventListener("click",handleSigninClick),logoutBtn.addEventListener("click",handleSignoutClick),form.addEventListener("submit",searchChannel),loadMoreChannelBtn.addEventListener("click",loadMoreChannels);